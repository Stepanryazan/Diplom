version: '3'

services:
     db:
       image: postgres:latest
       env_file:
         - .env
       environment:
         POSTGRES_DB: ${POSTGRES_DB}
         POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
         POSTGRES_USER: ${POSTGRES_USER}
         POSTGRES_HOST: ${POSTGRES_HOST}
       ports:
         - "5432:5433"

     es:
       image: elasticsearch:6.5.0
       ports:
         - "9200:9200"

     app:
       build: .
       tty: true
       ports:
         - "8000:8000"
       restart: on-failure
       command: sh -c "python manage.py migrate && python manage.py runserver 0.0.0.0:8000"
       volumes:
         - .:/app
       depends_on:
         - db
         - es

       env_file:
         - .env